#!/usr/bin/env node
'use strict';

// loads all of the files in our lib folder and neatly packs them in our app object
var path = require("path");
var loader = require('auto-loader');

var controllers = loader.load( path.dirname(__dirname) + '/lib/controllers');
var assets = loader.load( path.dirname(__dirname) + '/lib/assets');
// var models = loader.load( path.dirname(__dirname) + '/lib/models');

var columnify = require('columnify');
var readline = require('readline');

// this will set up the checklog first
controllers.setup.install();

var arg = assets._args;

// set everything to debug mode
if(arg.hasArg('debug') && arg.getArg('debug') === true){
    for(var key in app ){
        app[key].debug = true;
    };   
}

var action = arg.getAction();

/* accepted actions */
var accepts = ['start', 'stop', 'help', 'distract', 'create', 'list', 'update', 'assign'];

/* create mode */
if( action == 'create' ){
    controllers.creator._(arg);
} else if( action == 'list' ){
    var printAll = false;
    /* this part just does not work! */
    if(!arg.hasPos(1)){
        var r1 = readline.createInterface({
            input: process.stdin,
            output: process.stdout
        });
        
        r1.question("Do you want to list all projects and all tasks? [Y|n]: ", (answer) => {
            console.log("WHAT THE FUCK IS GOING ON! :", answer);
            if(answer.toUpperCase() == "Y" ){
                printAll = true;
            }
            r1.close();
        });
    }
    controllers.lister._(arg, printAll);

}else if ( action == 'delete' ){
    controllers.deleter._(arg);
}else if ( action == 'assign' ){
    controllers.assigner._(arg);
}else if ( action == 'update' ){
    controllers.updater._(arg);
}else if ( action == 'start' ){

}else if ( action == 'stop' ){

}else if ( action == 'help' ){

}else if ( action == 'distract' ){

}else{
    console.log("Sorry, no accept action passed");
}

process.exit();